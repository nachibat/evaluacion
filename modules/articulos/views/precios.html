{% extends '../../template.html' %}

{% block styles %} 
    <style type="text/css">
        .btn:disabled{
            cursor: no-drop;
        }
        .cursor-pointer {
            cursor: pointer;
        }
        .ops{
            text-align: center;
            padding: 0.1rem .75rem !important;
            vertical-align: middle !important;
        }
        .ops [disabled]{
            opacity: 0.2;
        }
    </style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12 mb-4 d-flex">
        <h4 id="title"><i class="fa fa-archive"></i>&nbsp;{{ pagename }}</h4>
    </div>
    <div class="col-md-6">
        <div class="form-group">
            <label for="porcentaje"><b>Porcentaje</b></label>
            <input class="form-control" maxlength="50" type="number" id="porcentaje" placeholder="Porcentaje" autocomplete="off">
        </div>
    </div>
    <div class="col-md-6">
        <div class="form-group">
            <label for="rubro"><b>Rubro</b></label>
            <select id="rubro"class="form-control">
                {% for r in rubros %}
                    <option value="{{ r.id }}">{{ r.descripcion }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="col-md-6">
        <div class="form-check cursor-pointer">
            <input class="form-check-input cursor-pointer" type="radio" name="accion" id="aumento" checked>
            <label class="form-check-label cursor-pointer" for="aumento">Porcentaje de aumento</label>
        </div>
        <div class="form-check cursor-pointer">
            <input class="form-check-input cursor-pointer" type="radio" name="accion" id="disminucion">
            <label class="form-check-label cursor-pointer" for="disminucion">Porcentaje de disminuci√≥n</label>
        </div>
    </div>
    <div class="col-12">
        <div class="form-group" style="float: right;">
            <button id="Guardar" onclick="ModificarPrecio()" class="btn btn-round btn-success"><i class="fa fa-save"></i>&nbsp;Guardar</button>
            <a href="/articulos/lista" class="btn btn-round btn-danger"><i class="fa fa-backward"></i>&nbsp;Volver</a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function ModificarPrecio() {
        let accion = 'aumentar';
        if ($('#disminucion').prop('checked')) accion = 'disminuir';
        const body = {
            porcentaje: $('#porcentaje').val(),
            rubro: $('#rubro').val(),
            accion
        };
        Swal.fire({
            title: 'Confirmar',
            text: "Desea cambiar precios masivamente?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Aceptar',
            cancelButtonText: 'Cancelar',
        }).then(async result => {
            if (result.value) {
                $("#preloader").show();
                    const res = await $.post("/articulos/precios-masivos", body );
                    $("#preloader").hide();
                    Swal.fire({
                        icon: res.type,
                        title: res.title,
                        text: res.text
                    }).then(() => {
                        if (res.type == 'success') window.location = "/articulos/lista";
                    });
            }
        });
    }
</script>
{% endblock %}